jobs:
  deploy-static-resources:
    runs-on: ubuntu-latest

    steps:
      # Step 1: 检出 main 分支
      - name: Checkout main Branch
        uses: actions/checkout@v3
        with:
          ref: main

      # Step 2: 验证工作区中的文件
      - name: Verify files in workspace
        run: |
          echo "Current working directory:"
          pwd
          echo "Listing all files in workspace:"
          ls -R

      # Step 3: 设置 SSH 密钥
      - name: Set up SSH
        uses: webfactory/ssh-agent@v0.5.3
        with:
          ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

      # Step 4: 将静态资源同步到服务器
      - name: Deploy Static Resources to Server
        run: |
          SOURCE_DIR=/home/runner/work/Hello_technical_writing/Hello_technical_writing
          TARGET_DIR=/www/wwwroot/hello_technical_writing
          ssh -T -o StrictHostKeyChecking=no root@162.14.117.33 << EOF
            echo "Running rsync on remote server..."
            mkdir -p \$TARGET_DIR
            rsync -avz --delete \$SOURCE_DIR/ \$TARGET_DIR/
            if [ \$? -ne 0 ]; then
              echo "Error: rsync failed!"
              exit 1
            fi
            echo "Static resources have been updated on the server."
          EOF